<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sorek Empire</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root { --accent: #00d2ff; --gold: #ffca28; --bg: #0a0a0a; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* HEADER */
        header { padding: 15px; background: #111; display: flex; justify-content: space-between; border-bottom: 2px solid #222; }
        .badge { background: var(--accent); color: black; padding: 2px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }

        /* CLICK AREA */
        #main-display { text-align: center; margin-top: 40px; }
        #score-big { font-size: 3.5rem; font-weight: 800; color: var(--accent); text-shadow: 0 0 20px rgba(0,210,255,0.4); display: block; }
        #btn-clicker { 
            width: 200px; height: 200px; border-radius: 50%; border: 8px solid var(--accent); 
            background: radial-gradient(circle, #222, #000); font-size: 5rem; 
            margin: 20px auto; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.05s; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        #btn-clicker:active { transform: scale(0.9); }

        /* UI ELEMENTS */
        .view { display: none; padding: 20px; height: 100%; overflow-y: auto; text-align: center; }
        .view.active { display: block; }
        .btn { width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; background: var(--accent); color: black; }
        input { width: 100%; padding: 15px; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 10px; margin-bottom: 10px; }
        
        /* CHAT */
        #chat-box { height: 200px; background: black; border-radius: 10px; overflow-y: auto; padding: 10px; text-align: left; font-size: 0.9rem; margin-bottom: 10px; }

        /* NAV */
        nav { height: 70px; background: #111; border-top: 2px solid #222; display: flex; justify-content: space-around; align-items: center; }
        .nav-item { color: #555; font-size: 0.8rem; cursor: pointer; text-align: center; }
        .nav-item.active { color: var(--accent); }

        #auth-overlay { position: fixed; inset: 0; background: black; z-index: 1000; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div style="width: 80%; max-width: 300px; text-align: center;">
            <h1 style="color:var(--accent)">SOREK EMPIRE</h1>
            <input id="u" placeholder="Pseudo">
            <input id="p" type="password" placeholder="Mot de passe">
            <button class="btn" onclick="auth('login')">ENTRER</button>
            <button class="btn" style="background:none; color:var(--accent); border:1px solid var(--accent)" onclick="auth('register')">S'INSCRIRE</button>
        </div>
    </div>

    <header>
        <span id="rank-badge" class="badge">Vagabond</span>
        <span id="guild-display" style="color:var(--gold); font-weight: bold;">[SOLO]</span>
    </header>

    <main>
        <div id="view-clicker" class="view active">
            <div id="main-display">
                <span id="score-big">0</span>
                <p style="margin:0; color:#666">clics accumul√©s</p>
                <button id="btn-clicker" onclick="clickAction()">üëÜ</button>
                <p>Puissance actuelle : <b id="mult-val">1</b></p>
                <button class="btn" onclick="socket.emit('buy_upgrade')">BOOSTER CLICS (üí∞ <span id="cost-val">100</span>)</button>
            </div>
        </div>

        <div id="view-casino" class="view">
            <h2 style="color:var(--gold)">üé∞ CASINO ROYAL</h2>
            <div style="font-size: 4rem; margin: 30px 0;" id="slot-machine">‚ùì ‚ùì ‚ùì</div>
            <button class="btn" style="background:var(--gold)" onclick="spinCasino()" id="btn-spin">MISER 500 CLICS</button>
            <p id="casino-msg"></p>
        </div>

        <div id="view-guild" class="view">
            <h2>üõ°Ô∏è VOTRE GUILDE</h2>
            <input id="g-name" placeholder="Nom de la guilde">
            <button class="btn" onclick="createGuild()">FONDER LA GUILDE</button>
        </div>

        <div id="view-chat" class="view">
            <h2>üí¨ CHAT MONDIAL</h2>
            <div id="chat-box"></div>
            <div style="display:flex; gap:5px;">
                <input id="mi" placeholder="Message..." style="margin:0;">
                <button class="btn" style="width:60px; margin:0" onclick="sendMsg()">‚û§</button>
            </div>
        </div>
    </main>

    <nav>
        <div class="nav-item active" onclick="showV('clicker', this)">Click</div>
        <div class="nav-item" onclick="showV('casino', this)">Casino</div>
        <div class="nav-item" onclick="showV('guild', this)">Guilde</div>
        <div class="nav-item" onclick="showV('chat', this)">Chat</div>
    </nav>

    <script>
        const socket = io();
        let myMult = 1;
        let audioCtx = null;

        // --- MOTEUR DE SON ---
        function playSfx(f, type="sine") {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type;
            osc.connect(g); g.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        // --- AUTH ---
        function auth(t) {
            const u = document.getElementById('u').value;
            const p = document.getElementById('p').value;
            if(u && p) socket.emit('login_action', {pseudo: u, password: p, type: t});
        }
        socket.on('login_ok', d => {
            document.getElementById('auth-overlay').style.display = 'none';
            updateUI(d);
        });

        function updateUI(d) {
            if(d.clicks !== undefined) document.getElementById('score-big').innerText = d.clicks;
            if(d.rank) document.getElementById('rank-badge').innerText = d.rank;
            if(d.guild) document.getElementById('guild-display').innerText = `[${d.guild.toUpperCase()}]`;
            if(d.mult) {
                myMult = d.mult;
                document.getElementById('mult-val').innerText = d.mult;
                document.getElementById('cost-val').innerText = d.mult * 100;
            }
        }

        socket.on('update_score', d => {
            document.getElementById('score-big').innerText = d.clicks;
            document.getElementById('rank-badge').innerText = d.rank;
        });

        socket.on('update_full_state', d => updateUI(d));

        // --- ACTIONS ---
        function clickAction() {
            playSfx(440);
            let s = document.getElementById('score-big');
            s.innerText = parseInt(s.innerText) + myMult;
            socket.emit('add_click');
        }

        function spinCasino() {
            socket.emit('spin_wheel');
            let slot = document.getElementById('slot-machine');
            let itv = setInterval(() => {
                const emo = ["üçí","üíé","7Ô∏è‚É£","üçã","üçÄ"];
                slot.innerText = emo[Math.floor(Math.random()*5)] + " " + emo[Math.floor(Math.random()*5)] + " " + emo[Math.floor(Math.random()*5)];
                playSfx(200, "square");
            }, 100);

            socket.once('spin_result', d => {
                setTimeout(() => {
                    clearInterval(itv);
                    if(d.outcome === 'gagn√©') {
                        slot.innerText = "üíé üíé üíé";
                        playSfx(880);
                        alert("JACKPOT !");
                    } else {
                        slot.innerText = "‚ùå üçã üçí";
                        playSfx(150, "sawtooth");
                    }
                    document.getElementById('score-big').innerText = d.clicks;
                }, 1000);
            });
        }

        function createGuild() {
            const n = document.getElementById('g-name').value;
            if(n) socket.emit('create_guild', {name: n});
        }

        function sendMsg() {
            const i = document.getElementById('mi');
            if(i.value) socket.emit('msg', {m: i.value});
            i.value = "";
        }

        socket.on('new_msg', d => {
            const b = document.getElementById('chat-box');
            b.innerHTML += `<div><small>${d.r}</small> <b>${d.p}:</b> ${d.m}</div>`;
            b.scrollTop = b.scrollHeight;
        });

        function showV(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            el.classList.add('active');
        }
        
        socket.on('notif', m => alert(m));
    </script>
</body>
</html>
