<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Sorek Clicker - HUD Classique</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { margin: 0; background: #0f0c29; color: white; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR (TON HUD D'AVANT) */
        .sidebar { width: 260px; background: #1a1a2e; border-right: 3px solid #e94560; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .stat-card { background: #16213e; padding: 15px; border-radius: 8px; border: 1px solid #444; }
        
        /* CLICKER CENTRAL */
        .main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, #1a1a2e 0%, #0f0c29 100%); }
        #click-btn { width: 220px; height: 220px; border-radius: 50%; border: 8px solid white; background: #e94560; font-size: 2em; font-weight: bold; cursor: pointer; box-shadow: 0 0 40px #e94560; transition: 0.1s; display: flex; align-items: center; justify-content: center; }
        #click-btn:active { transform: scale(0.9); }

        /* BOUTON SOCIAL AVEC BADGE */
        .social-container { position: relative; width: 100%; }
        .badge { position: absolute; top: -8px; right: -8px; background: red; border-radius: 50%; padding: 3px 8px; font-size: 12px; display: none; }

        /* MODAL ET ONGLETS */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #16213e; border: 2px solid #e94560; padding: 20px; border-radius: 12px; z-index: 100; width: 400px; }
        .tab-btn { background: #1a1a2e; color: white; border: 1px solid #e94560; padding: 8px; cursor: pointer; }
        .tab-btn.active { background: #e94560; }
        .tab-content { display: none; margin-top: 15px; max-height: 300px; overflow-y: auto; }
        
        button { background: #e94560; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        input { background: #0f0c29; border: 1px solid #e94560; color: white; padding: 8px; border-radius: 5px; }
        .item { display: flex; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 8px; margin: 5px 0; border-radius: 4px; align-items: center; }
        
        #login-screen { position: fixed; width: 100%; height: 100%; background: #0f0c29; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h2>SOREK CLICKER</h2>
        <input type="text" id="pseudo" placeholder="Pseudo">
        <input type="password" id="password" placeholder="Mot de passe">
        <button onclick="auth('login')">Se connecter</button>
        <button onclick="auth('register')">S'inscrire</button>
    </div>

    <div class="sidebar">
        <div class="stat-card">
            <h3 id="u-pseudo">...</h3>
            <p>üèÖ Rang: <span id="u-rank">Vagabond</span></p>
            <p>üè∞ Guilde: <span id="u-guild">Aucune</span></p>
        </div>
        
        <div class="social-container">
            <button onclick="openSocial()" style="width:100%">üí¨ SOCIAL</button>
            <span id="global-badge" class="badge">0</span>
        </div>

        <button onclick="socket.emit('buy_upgrade')" style="background:#27ae60">üöÄ BOOSTER (x<span id="u-mult">1</span>)</button>
        
        <div style="margin-top:auto; font-size: 0.8em; color: #888;">
            <b>Amis :</b>
            <div id="mini-friends"></div>
        </div>
    </div>

    <div class="main">
        <h1 style="font-size: 3em;"><span id="u-score">0</span> Clics</h1>
        <div id="click-btn">CLIC !</div>
    </div>

    <div id="social-modal" class="modal">
        <div style="display:flex; justify-content:space-between;">
            <h3>Menu Social</h3>
            <button onclick="toggleSocial()" style="background:red">X</button>
        </div>
        <div style="display:flex; gap:2px;">
            <button class="tab-btn active" onclick="showTab('t-chat')">Tchat</button>
            <button class="tab-btn" onclick="showTab('t-friends')">Amis</button>
            <button class="tab-btn" onclick="showTab('t-req')">Demandes <span id="dot" style="color:red;display:none;">‚óè</span></button>
        </div>

        <div id="t-chat" class="tab-content" style="display:block;">
            <div id="chat-box" style="height:200px; border:1px solid #444; overflow-y:auto; margin-bottom:10px; padding:5px;"></div>
            <input type="text" id="m-in" placeholder="Message..." style="width:70%">
            <button onclick="sendMsg()">OK</button>
        </div>

        <div id="t-friends" class="tab-content">
            <input type="text" id="f-in" placeholder="Pseudo...">
            <button onclick="socket.emit('send_friend_request', {target: document.getElementById('f-in').value})">Ajouter</button>
            <div id="f-list"></div>
        </div>

        <div id="t-req" class="tab-content">
            <p><b>ü§ù Amis :</b></p>
            <div id="r-list"></div>
            <hr>
            <p><b>üõ°Ô∏è Guildes :</b></p>
            <div id="g-list"></div>
        </div>
    </div>

    <script>
        const socket = io();
        let myP = "";
        let unread = 0;

        function auth(t) { socket.emit('login_action', {pseudo: document.getElementById('pseudo').value, password: document.getElementById('password').value, type: t}); }

        socket.on('login_ok', (data) => {
            myP = data.pseudo;
            document.getElementById('login-screen').style.display = 'none';
            updateUI(data);
        });

        socket.on('update_score', (data) => updateUI(data));
        socket.on('update_full_state', (data) => updateUI(data));
        socket.on('success', (m) => alert(m));
        socket.on('error', (m) => alert(m));

        function updateUI(d) {
            if(d.pseudo) document.getElementById('u-pseudo').innerText = d.pseudo;
            if(d.clicks !== undefined) document.getElementById('u-score').innerText = Math.floor(d.clicks);
            if(d.mult !== undefined) document.getElementById('u-mult').innerText = d.mult;
            if(d.rank) document.getElementById('u-rank').innerText = d.rank;
            if(d.guild) document.getElementById('u-guild').innerText = d.guild;
        }

        // SOCIAL LOGIC
        socket.on('social_update', (d) => {
            // Amis
            document.getElementById('f-list').innerHTML = d.friends.map(f => `<div class="item"><span>${f}</span></div>`).join('');
            document.getElementById('mini-friends').innerHTML = d.friends.map(f => `<div>üü¢ ${f}</div>`).join('');
            
            // Demandes Amis
            document.getElementById('r-list').innerHTML = d.friend_requests.map(r => `
                <div class="item"><span>${r}</span>
                    <div>
                        <button onclick="socket.emit('respond_friend_request',{target:'${r}',action:'accept'})" style="background:green">‚úî</button>
                        <button onclick="socket.emit('respond_friend_request',{target:'${r}',action:'decline'})" style="background:red">‚úñ</button>
                    </div>
                </div>`).join('') || "Aucune demande";

            // Invitations Guilde
            document.getElementById('g-list').innerHTML = d.guild_invites.map(g => `
                <div class="item"><span>${g}</span>
                    <button onclick="socket.emit('respond_guild_invite',{guild_name:'${g}',action:'accept'})" style="background:green">Rejoindre</button>
                </div>`).join('') || "Aucune invitation";

            const total = d.friend_requests.length + d.guild_invites.length;
            document.getElementById('dot').style.display = total > 0 ? 'inline' : 'none';
            checkGlobalBadge(total);
        });

        socket.on('new_msg', (d) => {
            const b = document.getElementById('chat-box');
            b.innerHTML += `<div><b>${d.p}:</b> ${d.m}</div>`;
            b.scrollTop = b.scrollHeight;
            if(document.getElementById('social-modal').style.display !== 'block') {
                unread++;
                checkGlobalBadge();
            }
        });

        function checkGlobalBadge(reqCount = 0) {
            const badge = document.getElementById('global-badge');
            const total = unread + reqCount;
            badge.innerText = total;
            badge.style.display = total > 0 ? 'block' : 'none';
        }

        function openSocial() { toggleSocial(); unread = 0; checkGlobalBadge(); }
        function toggleSocial() { 
            const m = document.getElementById('social-modal');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).style.display = 'block';
            event.target.classList.add('active');
        }
        function sendMsg() { socket.emit('msg', {m: document.getElementById('m-in').value}); document.getElementById('m-in').value=''; }
        document.getElementById('click-btn').onclick = () => socket.emit('add_click');
    </script>
</body>
</html>

