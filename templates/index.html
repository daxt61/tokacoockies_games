<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TokaCookies Empire</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root { --accent: #00d2ff; --bg: #0d1117; --panel: #161b22; --border: #30363d; --green: #2ecc71; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .card { background: var(--panel); padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin: 10px; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; cursor: pointer; background: var(--accent); font-weight: bold; color: #000; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid var(--border); background: #000; color: #fff; box-sizing: border-box;}
        #cookie-btn { width: 150px; height: 150px; border-radius: 50%; background: #222; border: 5px solid var(--accent); font-size: 60px; display: flex; align-items: center; justify-content: center; margin: 20px auto; cursor: pointer; user-select: none; }
        .view { display: none; padding: 10px; flex: 1; overflow-y: auto; }
        .view.active { display: block; }
        nav { display: flex; background: var(--panel); border-top: 1px solid var(--border); height: 60px; }
        .nav-item { flex: 1; text-align: center; padding: 10px; cursor: pointer; }
        #toast { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); background: var(--green); color: #000; padding: 10px 20px; border-radius: 20px; display: none; z-index: 1000; }
    </style>
</head>
<body>
    <div id="toast"></div>

    <div id="auth-overlay" style="position:fixed; inset:0; background:var(--bg); z-index:100; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:300px;">
            <h2 style="text-align:center; color:var(--accent);">üç™ TOKA EMPIRE</h2>
            <input id="pseudo" placeholder="Pseudo">
            <input id="pass" type="password" placeholder="Mot de passe">
            <button class="btn" onclick="auth('login')">CONNEXION</button>
            <button onclick="auth('register')" style="background:none; border:none; color:#888; width:100%; margin-top:10px; cursor:pointer;">Cr√©er un compte</button>
        </div>
    </div>

    <header style="padding:15px; background:var(--panel); border-bottom:1px solid var(--border); display:flex; justify-content:space-between;">
        <b id="my-name">Chargement...</b>
        <span id="my-guild" style="color:var(--accent);">[SOLO]</span>
    </header>

    <div id="view-game" class="view active">
        <h1 id="score-text" style="text-align:center; font-size:3.5rem; margin:20px 0;">0</h1>
        <div id="cookie-btn" onclick="socket.emit('add_click')">üç™</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="card" style="text-align:center;">
                <b>Multi: x<span id="mult-text">1</span></b><br>
                <button class="btn" style="margin-top:10px" onclick="socket.emit('buy_upgrade', {type:'mult'})">BOOST</button>
            </div>
            <div class="card" style="text-align:center;">
                <b>Auto: <span id="auto-text">0</span>/s</b><br>
                <button class="btn" style="margin-top:10px; background:var(--green)" onclick="socket.emit('buy_upgrade', {type:'auto'})">ACHETER</button>
            </div>
        </div>
    </div>

    <div id="view-social" class="view">
        <div class="card">
            <h3>üë• Ajouter un ami</h3>
            <div style="display:flex; gap:5px;">
                <input id="f-input" placeholder="Pseudo de l'ami" style="margin:0;">
                <button class="btn" style="width:80px" onclick="addFriend()">ADD</button>
            </div>
        </div>
        <div class="card">
            <h3>üìú Liste d'amis</h3>
            <ul id="friends-list" style="list-style:none; padding:0;"></ul>
        </div>
    </div>

    <div id="view-chat" class="view">
        <div class="card" id="chat-box" style="height:300px; overflow-y:auto; background:#000;"></div>
        <div class="card" style="display:flex; gap:5px;">
            <input id="chat-input" placeholder="Message..." style="margin:0;">
            <button class="btn" style="width:80px" onclick="sendChat()">ENVOYER</button>
        </div>
    </div>

    <nav>
        <div class="nav-item" onclick="show('game')">üïπÔ∏è<br>JEU</div>
        <div class="nav-item" onclick="show('social')">üë•<br>SOCIAL</div>
        <div class="nav-item" onclick="show('chat')">üí¨<br>CHAT</div>
    </nav>

    <script>
        const socket = io();
        function auth(type) { socket.emit('login_action', {pseudo: document.getElementById('pseudo').value, password: document.getElementById('pass').value, type}); }
        function show(id) { document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); document.getElementById('view-'+id).classList.add('active'); }
        function addFriend() { socket.emit('add_friend', {pseudo: document.getElementById('f-input').value}); document.getElementById('f-input').value=""; }
        function sendChat() { socket.emit('send_chat', {msg: document.getElementById('chat-input').value}); document.getElementById('chat-input').value=""; }

        socket.on('login_ok', d => { document.getElementById('auth-overlay').style.display = 'none'; updateUI(d); });
        socket.on('update_score', d => updateUI(d));
        socket.on('update_full_state', d => updateUI(d));
        
        socket.on('update_friends', d => {
            document.getElementById('friends-list').innerHTML = d.friends.map(f => `<li style="padding:10px; border-bottom:1px solid #333;">üë§ ${f}</li>`).join('');
        });

        socket.on('new_chat', d => {
            const b = document.getElementById('chat-box');
            b.innerHTML += `<div><b>${d.user}:</b> ${d.text}</div>`;
            b.scrollTop = b.scrollHeight;
        });

        function updateUI(d) {
            if(d.pseudo) document.getElementById('my-name').innerText = d.pseudo;
            if(d.clicks !== undefined) document.getElementById('score-text').innerText = Math.floor(d.clicks).toLocaleString();
            if(d.mult !== undefined) document.getElementById('mult-text').innerText = d.mult;
            if(d.auto !== undefined) document.getElementById('auto-text').innerText = d.auto;
            if(d.guild) document.getElementById('my-guild').innerText = `[${d.guild}]`;
        }

        socket.on('success', m => { const t = document.getElementById('toast'); t.innerText = m; t.style.display = 'block'; setTimeout(()=>t.style.display='none', 2000); });
        socket.on('error', m => alert(m));
    </script>
</body>
</html>
