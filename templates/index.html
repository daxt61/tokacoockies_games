<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sorek Hub V7 - Ultimate</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --accent: #58a6ff; --gold: #f1c40f; --red: #f85149; --green: #238636; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; }
        body { background: var(--bg); color: #c9d1d9; margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        header { padding: 15px; background: var(--panel); border-bottom: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; padding-top: env(safe-area-inset-top, 15px); }
        .stat-box { display: flex; flex-direction: column; }
        .badge { background: #30363d; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: var(--accent); font-weight: bold; width: fit-content; }

        /* NAVIGATION BASSE */
        nav { height: 70px; background: var(--panel); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #30363d; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; color: #8b949e; font-size: 0.75rem; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 2px; }

        /* VUES */
        main { flex: 1; overflow-y: auto; position: relative; }
        .view { display: none; padding: 20px; height: 100%; }
        .view.active { display: block; animation: fadeIn 0.2s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* BOUTONS & INPUTS */
        .btn { width: 100%; padding: 14px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; background: var(--accent); color: white; }
        input { width: 100%; padding: 12px; background: #010409; border: 1px solid #30363d; color: white; border-radius: 8px; margin-bottom: 10px; }
        
        /* CLICKER */
        #btn-clicker { width: 160px; height: 160px; border-radius: 50%; border: 6px solid var(--accent); background: #161b22; font-size: 4.5rem; cursor: pointer; margin: 20px auto; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(88, 166, 255, 0.2); }
        #btn-clicker:active { transform: scale(0.92); }

        /* CASINO */
        .slot-machine { background: #000; padding: 20px; border-radius: 15px; border: 2px solid var(--gold); text-align: center; }
        .slot-row { display: flex; justify-content: center; gap: 10px; font-size: 3rem; margin: 15px 0; }

        /* CHAT */
        #chat-msgs { height: 250px; overflow-y: auto; background: #010409; padding: 10px; border-radius: 8px; text-align: left; font-size: 0.9rem; }
        
        /* FRIENDS */
        .friend-card { display: flex; justify-content: space-between; background: #1c2128; padding: 10px; border-radius: 6px; margin-bottom: 8px; align-items: center; }
        .online-dot { width: 8px; height: 8px; background: #238636; border-radius: 50%; display: inline-block; margin-right: 5px; }

        #auth-overlay { position: fixed; inset: 0; background: #0d1117; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div style="width: 85%; max-width: 320px; text-align: center;">
            <h1 style="color:var(--accent)">SOREK HUB V7</h1>
            <input id="u" placeholder="Pseudo">
            <input id="p" type="password" placeholder="Mot de passe">
            <button class="btn" onclick="auth('login')">CONNEXION</button>
            <button class="btn" style="background:none; border:1px solid #30363d" onclick="auth('register')">S'INSCRIRE</button>
        </div>
    </div>

    <header>
        <div class="stat-box">
            <span id="rank-badge" class="badge">Vagabond</span>
            <span style="font-size: 1.3rem; font-weight: bold;"><span id="score-val">0</span> üí∞</span>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.75rem; color: #8b949e;">Guilde</div>
            <div id="guild-tag" style="color:var(--gold); font-weight: bold;">Aucune</div>
        </div>
    </header>

    <main>
        <div id="view-clicker" class="view active">
            <button id="btn-clicker" onclick="clickAction()">üëÜ</button>
            <p>Puissance de clic : <b>x<span id="mult-val">1</span></b></p>
            <button class="btn" onclick="socket.emit('buy_upgrade')">AM√âLIORER (üí∞ <span id="cost-val">100</span>)</button>
            <div id="rel-lb" style="margin-top:20px; font-size:0.85rem; background:rgba(0,0,0,0.2); padding:10px; border-radius:8px;"></div>
        </div>

        <div id="view-casino" class="view">
            <h2 style="color:var(--gold)">SOREK CASINO</h2>
            <div class="slot-machine">
                <div class="slot-row">
                    <span id="s1">üé∞</span><span id="s2">üé∞</span><span id="s3">üé∞</span>
                </div>
                <button class="btn" style="background:var(--gold); color:black" onclick="spinCasino()" id="btn-spin">MISER 500 üí∞</button>
            </div>
        </div>

        <div id="view-guild" class="view">
            <h3>üõ°Ô∏è GUILDE</h3>
            <div id="guild-content">
                <input id="g-name" placeholder="Nom de la guilde">
                <button class="btn" onclick="createGuild()">CR√âER GUILDE</button>
                <hr style="border:0; border-top:1px solid #30363d; margin:20px 0;">
                <button class="btn" style="background:var(--red)" onclick="socket.emit('trahir_guilde')">TRAHIR LA GUILDE</button>
            </div>
        </div>

        <div id="view-social" class="view">
            <h3>üë• AMIS</h3>
            <div style="display:flex; gap:5px;">
                <input id="f-name" placeholder="Ajouter un ami..." style="margin:0;">
                <button class="btn" style="width:50px; margin:0;" onclick="addFriend()">+</button>
            </div>
            <div id="friends-list" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div>

            <h3 style="margin-top:20px;">üí¨ TCHAT GLOBAL</h3>
            <div id="chat-msgs"></div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input id="mi" placeholder="Message..." style="margin:0;">
                <button class="btn" style="width:60px; margin:0;" onclick="sendMsg()">‚û§</button>
            </div>
        </div>
    </main>

    <nav>
        <div class="nav-item active" onclick="showV('clicker', this)"><i>üñ±Ô∏è</i>Click</div>
        <div class="nav-item" onclick="showV('casino', this)"><i>üé∞</i>Casino</div>
        <div class="nav-item" onclick="showV('guild', this)"><i>üõ°Ô∏è</i>Guilde</div>
        <div class="nav-item" onclick="showV('social', this)"><i>üí¨</i>Social</div>
    </nav>

    <script>
        const socket = io();
        let myMult = 1;
        let audioCtx = null;
        let myPseudo = "";

        // --- AUTH ---
        function auth(t) {
            const u = document.getElementById('u').value.trim();
            const p = document.getElementById('p').value;
            if(u && p) {
                myPseudo = u;
                socket.emit('login_action', {pseudo: u, password: p, type: t});
            }
        }
        socket.on('login_ok', d => {
            document.getElementById('auth-overlay').style.display = 'none';
            updateUI(d);
        });
        socket.on('auth_error', m => alert(m));

        // --- UI CORE ---
        function updateUI(d) {
            if(d.clicks !== undefined) document.getElementById('score-val').innerText = d.clicks;
            if(d.mult !== undefined) {
                document.getElementById('mult-val').innerText = d.mult;
                document.getElementById('cost-val').innerText = d.mult * 100;
                myMult = d.mult;
            }
            if(d.rank) document.getElementById('rank-badge').innerText = d.rank;
            if(d.guild) document.getElementById('guild-tag').innerText = d.guild;

            // Emoji update
            const emojis = ["üëÜ", "üëä", "üî•", "üíé", "üëë", "üöÄ", "‚ö°"];
            let idx = Math.min(Math.floor((d.clicks || 0) / 1000), emojis.length - 1);
            document.getElementById('btn-clicker').innerText = emojis[idx];
        }

        socket.on('update_score', d => updateUI(d));
        socket.on('update_full_state', d => updateUI(d));

        // --- CLICKER ---
        function clickAction() {
            let s = document.getElementById('score-val');
            s.innerText = parseInt(s.innerText) + myMult;
            socket.emit('add_click');
        }

        // --- CASINO ---
        function spinCasino() {
            socket.emit('spin_wheel');
            let anim = setInterval(() => {
                const syms = ["üçí","üçã","üíé","7Ô∏è‚É£","üé∞"];
                document.getElementById('s1').innerText = syms[Math.floor(Math.random()*5)];
                document.getElementById('s2').innerText = syms[Math.floor(Math.random()*5)];
                document.getElementById('s3').innerText = syms[Math.floor(Math.random()*5)];
            }, 100);

            socket.once('spin_result', d => {
                setTimeout(() => {
                    clearInterval(anim);
                    const res = d.outcome === 'perdu' ? ["‚ùå","üçã","üçí"] : ["üíé","üíé","üíé"];
                    document.getElementById('s1').innerText = res[0];
                    document.getElementById('s2').innerText = res[1];
                    document.getElementById('s3').innerText = res[2];
                    alert(d.outcome === 'perdu' ? "Perdu !" : "GAGN√â !");
                }, 1000);
            });
        }

        // --- GUILDES ---
        function createGuild() {
            const n = document.getElementById('g-name').value;
            if(n) socket.emit('create_guild', {name: n});
        }

        // --- SOCIAL (CHAT & AMIS) ---
        function sendMsg() {
            const i = document.getElementById('mi');
            if(i.value) socket.emit('msg', {m: i.value});
            i.value = "";
        }
        socket.on('new_msg', d => {
            const b = document.getElementById('chat-msgs');
            b.innerHTML += `<div><small>[${d.r}]</small> <b>${d.p}:</b> ${d.m}</div>`;
            b.scrollTop = b.scrollHeight;
        });

        function addFriend() {
            const n = document.getElementById('f-name').value;
            if(n) socket.emit('add_friend', {target: n});
            document.getElementById('f-name').value = "";
        }
        socket.on('update_friends', d => {
            const list = document.getElementById('friends-list');
            list.innerHTML = d.friends.map(f => `
                <div class="friend-card">
                    <span><span class="online-dot" style="background:${f.online?'#238636':'#8b949e'}"></span>${f.name}</span>
                    <small>${f.online ? 'En ligne' : 'Hors ligne'}</small>
                </div>
            `).join('');
        });

        // --- NAVIGATION ---
        function showV(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            el.classList.add('active');
        }

        function clickAction() {
            let s = document.getElementById('score-val');
            s.innerText = parseInt(s.innerText) + myMult;
            socket.emit('add_click');
        }
    </script>
</body>
</html>

