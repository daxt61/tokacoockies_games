{% raw %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üç™ Cookie Empire - Ultimate Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root{--primary:#00d2ff;--primary-dark:#0091c7;--secondary:#8b5cf6;--accent:#f59e0b;--success:#10b981;--error:#ef4444;--bg:#0a0e27;--bg-secondary:#111827;--panel:#1f2937;--border:#374151;--text:#f9fafb;--text-secondary:#9ca3af}
        *{box-sizing:border-box;margin:0;padding:0}
        body{background:linear-gradient(135deg,var(--bg) 0%,#1a1f3a 100%);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;height:100dvh;display:flex;flex-direction:column;overflow:hidden}
        #particles{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
        .particle{position:absolute;width:2px;height:2px;background:var(--primary);border-radius:50%;opacity:.5;animation:float linear infinite}
        @keyframes float{0%{transform:translateY(100vh) scale(0);opacity:0}10%{opacity:.5}90%{opacity:.5}100%{transform:translateY(-10vh) scale(1);opacity:0}}
        #toast-container{position:fixed;top:70px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:350px}
        .toast{background:linear-gradient(135deg,rgba(0,210,255,.95),rgba(88,166,255,.95));backdrop-filter:blur(10px);border:2px solid var(--primary);color:#fff;padding:16px 20px;border-radius:12px;box-shadow:0 8px 32px rgba(0,210,255,.4);animation:slideInRight .3s cubic-bezier(.68,-.55,.265,1.55),fadeOut .3s ease-in 3s forwards;font-weight:600;display:flex;align-items:center;gap:12px}
        .toast.success{background:linear-gradient(135deg,rgba(16,185,129,.95),rgba(5,150,105,.95));border-color:var(--success);box-shadow:0 8px 32px rgba(16,185,129,.4)}
        .toast.error{background:linear-gradient(135deg,rgba(239,68,68,.95),rgba(220,38,38,.95));border-color:var(--error);box-shadow:0 8px 32px rgba(239,68,68,.4)}
        .toast.achievement{background:linear-gradient(135deg,rgba(245,158,11,.95),rgba(217,119,6,.95));border-color:var(--accent);box-shadow:0 8px 32px rgba(245,158,11,.6)}
        @keyframes slideInRight{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
        @keyframes fadeOut{to{opacity:0;transform:translateX(400px)}}
        header{padding:12px 20px;background:rgba(31,41,55,.8);backdrop-filter:blur(10px);display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid var(--border);box-shadow:0 4px 20px rgba(0,0,0,.3);z-index:100;position:relative}
        .user-info{display:flex;align-items:center;gap:12px}
        .avatar{width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--secondary));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;box-shadow:0 4px 12px rgba(0,210,255,.4);border:3px solid rgba(255,255,255,.1)}
        .user-details{display:flex;flex-direction:column;gap:4px}
        #my-pseudo{font-weight:700;font-size:1rem}
        .badge{padding:4px 12px;border-radius:6px;font-weight:700;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;display:inline-flex;align-items:center;gap:4px}
        .badge.rank{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
        .badge.guild{background:linear-gradient(135deg,var(--accent),#dc2626);color:#fff}
        .daily-btn{padding:8px 16px;background:linear-gradient(135deg,var(--success),#059669);border:none;border-radius:8px;color:#fff;font-weight:700;cursor:pointer;transition:all .2s;font-size:.85rem}
        .daily-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(16,185,129,.4)}
        .daily-btn:disabled{opacity:.5;cursor:not-allowed}
        main{flex:1;overflow:hidden;position:relative;z-index:1}
        .view{display:none;padding:20px;height:100%;overflow-y:auto;animation:fadeIn .3s ease-out}
        .view.active{display:block}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .clicker-container{max-width:600px;margin:0 auto;text-align:center}
        #score-display{font-size:clamp(2.5rem,8vw,4rem);font-weight:900;background:linear-gradient(135deg,var(--primary),var(--secondary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0;animation:pulseGlow 2s ease-in-out infinite}
        @keyframes pulseGlow{0%,100%{transform:scale(1);filter:brightness(1)}50%{transform:scale(1.02);filter:brightness(1.1)}}
        #click-button{width:180px;height:180px;border-radius:50%;border:6px solid var(--primary);background:linear-gradient(135deg,var(--panel),#2d3748);font-size:5rem;margin:30px auto;cursor:pointer;transition:all .1s cubic-bezier(.68,-.55,.265,1.55);display:flex;align-items:center;justify-content:center;box-shadow:0 0 40px rgba(0,210,255,.4),inset 0 -8px 20px rgba(0,0,0,.3);position:relative;user-select:none}
        #click-button:active{transform:scale(.88);box-shadow:0 0 60px rgba(0,210,255,.8),inset 0 -4px 10px rgba(0,0,0,.5)}
        #click-button::before{content:'';position:absolute;inset:-20px;border-radius:50%;background:radial-gradient(circle,var(--primary) 0%,transparent 70%);opacity:0;animation:ripple 1.5s infinite}
        @keyframes ripple{0%{transform:scale(.8);opacity:.8}100%{transform:scale(1.2);opacity:0}}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px;margin:25px 0}
        .stat-card{background:rgba(31,41,55,.6);backdrop-filter:blur(10px);padding:16px;border-radius:12px;border:1px solid var(--border);box-shadow:0 4px 15px rgba(0,0,0,.2)}
        .stat-label{font-size:.75rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
        .stat-value{font-size:1.5rem;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .btn{width:100%;padding:16px;border-radius:12px;border:none;font-weight:700;cursor:pointer;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;font-size:1rem;transition:all .2s;text-transform:uppercase;letter-spacing:1px;margin-top:12px;box-shadow:0 4px 15px rgba(0,210,255,.3)}
        .btn:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,210,255,.5)}
        .btn:active{transform:scale(.97)}
        .btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .btn.secondary{background:linear-gradient(135deg,var(--secondary),#6d28d9)}
        .btn.success{background:linear-gradient(135deg,var(--success),#059669)}
        .btn.small{padding:8px 12px;font-size:.85rem;margin:0}
        .leaderboard{background:rgba(31,41,55,.6);backdrop-filter:blur(10px);padding:20px;border-radius:16px;margin-top:30px;border:1px solid var(--border)}
        .leaderboard-title{text-align:center;color:var(--accent);font-weight:800;font-size:1.2rem;margin-bottom:20px;text-transform:uppercase;letter-spacing:2px}
        .lb-item{display:flex;justify-content:space-between;align-items:center;padding:12px;border-bottom:1px solid rgba(55,65,81,.5);transition:all .2s}
        .lb-item:hover{background:rgba(0,210,255,.05)}
        .lb-item.me{background:rgba(0,210,255,.1);border-left:4px solid var(--primary)}
        .lb-rank{width:36px;height:36px;background:var(--panel);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.9rem}
        .lb-rank.gold{background:linear-gradient(135deg,#ffd700,#ffed4e);color:#000;box-shadow:0 4px 15px rgba(255,215,0,.5)}
        .lb-rank.silver{background:linear-gradient(135deg,#c0c0c0,#e8e8e8);color:#000;box-shadow:0 4px 15px rgba(192,192,192,.5)}
        .lb-rank.bronze{background:linear-gradient(135deg,#cd7f32,#e8a057);color:#000;box-shadow:0 4px 15px rgba(205,127,50,.5)}
        .lb-player{flex:1;margin:0 15px}
        .lb-name{font-weight:700}
        .lb-guild{font-size:.75rem;color:var(--text-secondary)}
        .lb-score{font-weight:800;color:var(--primary);font-size:1.1rem}
        .powerups-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:20px}
        .powerup-card{background:rgba(31,41,55,.6);backdrop-filter:blur(10px);padding:20px;border-radius:12px;border:2px solid var(--border);text-align:center;transition:all .3s;cursor:pointer}
        .powerup-card:hover{transform:translateY(-5px);border-color:var(--primary);box-shadow:0 10px 30px rgba(0,210,255,.3)}
        .powerup-icon{font-size:3rem;margin-bottom:10px}
        .powerup-name{font-weight:700;font-size:1.1rem;margin-bottom:5px}
        .powerup-desc{font-size:.85rem;color:var(--text-secondary);margin-bottom:15px}
        .powerup-cost{font-weight:700;color:var(--accent);margin-bottom:10px}
        .achievements-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px}
        .achievement-card{background:rgba(31,41,55,.6);backdrop-filter:blur(10px);padding:20px;border-radius:12px;border:2px solid var(--border);display:flex;gap:15px;align-items:center;transition:all .3s}
        .achievement-card.unlocked{border-color:var(--accent);background:rgba(245,158,11,.1)}
        .achievement-card.locked{opacity:.5;filter:grayscale(.8)}
        .achievement-icon{font-size:3rem;flex-shrink:0}
        .achievement-info{flex:1}
        .achievement-name{font-weight:700;margin-bottom:5px}
        .achievement-desc{font-size:.85rem;color:var(--text-secondary);margin-bottom:5px}
        .achievement-reward{font-size:.8rem;color:var(--success);font-weight:600}
        .guild-header{background:linear-gradient(135deg,rgba(245,158,11,.2),rgba(220,38,38,.2));padding:25px;border-radius:16px;border:2px solid var(--accent);margin-bottom:20px;text-align:center}
        .guild-name{font-size:2rem;font-weight:900;color:var(--accent);margin-bottom:10px;text-transform:uppercase;letter-spacing:2px}
        .guild-stats{display:flex;justify-content:center;gap:30px;margin-top:15px}
        .guild-stat{text-align:center}
        .guild-stat-label{font-size:.75rem;color:var(--text-secondary);text-transform:uppercase}
        .guild-stat-value{font-size:1.5rem;font-weight:800;color:var(--primary)}
        .members-list{display:grid;gap:10px}
        .member-card{background:rgba(31,41,55,.6);padding:15px;border-radius:10px;border:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .friend-card{background:rgba(31,41,55,.6);padding:15px;border-radius:10px;border:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .request-card{background:rgba(31,41,55,.6);padding:15px;border-radius:10px;border:2px solid var(--primary);margin-bottom:10px}
        .request-actions{display:flex;gap:10px;margin-top:10px}
        .btn-accept{padding:8px 20px;background:var(--success);border:none;border-radius:6px;color:#fff;font-weight:700;cursor:pointer;transition:all .2s}
        .btn-decline{padding:8px 20px;background:var(--error);border:none;border-radius:6px;color:#fff;font-weight:700;cursor:pointer;transition:all .2s}
        #chat-box{height:300px;background:rgba(10,14,39,.8);border-radius:12px;overflow-y:auto;padding:15px;margin:15px 0;border:1px solid var(--border)}
        .chat-message{margin-bottom:12px;padding:10px;background:rgba(31,41,55,.4);border-radius:8px;border-left:3px solid var(--primary)}
        .chat-author{color:var(--primary);font-weight:700;margin-right:8px}
        .chat-text{color:var(--text)}
        input,textarea{width:100%;padding:14px;background:rgba(10,14,39,.8);border:2px solid var(--border);color:var(--text);border-radius:10px;font-family:inherit;font-size:1rem;transition:all .2s}
        input:focus,textarea:focus{outline:0;border-color:var(--primary);box-shadow:0 0 0 3px rgba(0,210,255,.1)}
        nav{height:75px;background:rgba(31,41,55,.8);backdrop-filter:blur(10px);display:flex;justify-content:space-around;align-items:center;border-top:2px solid var(--border);position:relative;z-index:100}
        .nav-item{color:var(--text-secondary);font-size:.75rem;cursor:pointer;text-align:center;padding:10px 15px;transition:all .2s;border-radius:10px;position:relative}
        .nav-item:hover{color:var(--primary);background:rgba(0,210,255,.1)}
        .nav-item.active{color:var(--primary);background:rgba(0,210,255,.15)}
        .nav-item.active::before{content:'';position:absolute;top:-2px;left:50%;transform:translateX(-50%);width:40px;height:3px;background:var(--primary);border-radius:0 0 3px 3px}
        .nav-icon{font-size:1.8rem;display:block;margin-bottom:4px}
        .notif-badge{position:absolute;top:5px;right:10px;background:var(--error);color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;box-shadow:0 2px 8px rgba(239,68,68,.5)}
        #auth-overlay{position:fixed;inset:0;background:linear-gradient(135deg,var(--bg) 0%,#1a1f3a 100%);z-index:10000;display:flex;align-items:center;justify-content:center}
        .auth-box{width:90%;max-width:400px;background:rgba(31,41,55,.95);backdrop-filter:blur(20px);padding:40px;border-radius:20px;border:2px solid var(--primary);box-shadow:0 20px 60px rgba(0,210,255,.3)}
        .auth-title{color:var(--primary);font-size:2.5rem;font-weight:900;text-align:center;margin-bottom:10px;text-transform:uppercase;letter-spacing:3px}
        .auth-subtitle{text-align:center;color:var(--text-secondary);margin-bottom:30px}
        ::-webkit-scrollbar{width:10px}
        ::-webkit-scrollbar-track{background:var(--bg-secondary)}
        ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,var(--primary),var(--secondary));border-radius:5px}
        ::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,var(--secondary),var(--primary))}
        .section-title{font-size:1.3rem;font-weight:800;color:var(--primary);margin:25px 0 15px;text-transform:uppercase;letter-spacing:2px}
        .empty-state{text-align:center;color:var(--text-secondary);padding:60px 20px;font-size:1rem}
        .empty-state-icon{font-size:4rem;margin-bottom:15px;opacity:.5}
        .powerup-active{position:fixed;top:70px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--accent),#dc2626);color:#fff;padding:12px 25px;border-radius:25px;font-weight:700;z-index:9999;box-shadow:0 8px 32px rgba(245,158,11,.6);animation:powerupPulse 1s ease-in-out infinite}
        @keyframes powerupPulse{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.05)}}
        @media (max-width:768px){#score-display{font-size:2.5rem}#click-button{width:150px;height:150px;font-size:4rem}.stats-grid{grid-template-columns:repeat(2,1fr)}.achievements-grid{grid-template-columns:1fr}#toast-container{right:10px;left:10px;max-width:none}}
        .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
        .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .flex{display:flex;gap:10px;align-items:center}
        .flex-between{display:flex;justify-content:space-between;align-items:center}
        .mt-20{margin-top:20px}
        .mb-20{margin-bottom:20px}
        .p-20{padding:20px}
    </style>
</head>
<body>
    <div id="particles"></div>
    <div id="toast-container"></div>
    <div id="auth-overlay">
        <div class="auth-box">
            <h1 class="auth-title">TOKAGAME EMPIRE</h1>
            <p class="auth-subtitle">Ultimate Edition v2.0</p>
            <input id="auth-user" placeholder="Username" maxlength="20">
            <input id="auth-pass" type="password" placeholder="Password" maxlength="50">
            <button class="btn" onclick="auth('login')">üéÆ LOGIN</button>
            <button class="btn secondary" onclick="auth('register')">üìù REGISTER</button>
        </div>
    </div>
    <header>
        <div class="user-info">
            <div class="avatar" id="my-avatar">?</div>
            <div class="user-details">
                <div id="my-pseudo">...</div>
                <span class="badge rank" id="rank-badge">Novice</span>
            </div>
        </div>
        <div class="flex" style="gap:10px">
            <span class="badge guild" id="guild-badge">[SOLO]</span>
            <button class="daily-btn" id="daily-btn" onclick="claimDaily()" disabled>üéÅ DAILY</button>
        </div>
    </header>
    <main>
        <div id="view-clicker" class="view active">
            <div class="clicker-container">
                <span id="score-display">0</span>
                <button id="click-button" onclick="clickAction()">üç™</button>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label">Power</div><div class="stat-value">x<span id="mult-val">1</span></div></div>
                    <div class="stat-card"><div class="stat-label">Auto/s</div><div class="stat-value"><span id="auto-val">0</span></div></div>
                    <div class="stat-card"><div class="stat-label">Prestige</div><div class="stat-value"><span id="prestige-val">0</span></div></div>
                    <div class="stat-card"><div class="stat-label">Rank</div><div class="stat-value" id="rank-display">1</div></div>
                </div>
                <div class="grid-2">
                    <button class="btn" onclick="buyUpgrade('mult')">üöÄ POWER<br><small>Cost: <span id="mult-cost">100</span></small></button>
                    <button class="btn success" onclick="buyUpgrade('auto')">‚ö° AUTO<br><small>Cost: <span id="auto-cost">1000</span></small></button>
                </div>
                <button class="btn secondary mt-20" onclick="prestige()" id="prestige-btn">‚ú® PRESTIGE (100K)</button>
                <div class="leaderboard">
                    <div class="leaderboard-title">üèÜ LEADERBOARD</div>
                    <div id="lb-content"></div>
                </div>
            </div>
        </div>
        <div id="view-shop" class="view">
            <div class="section-title">üõí SHOP</div>
            <div class="powerups-grid" id="shop-items"></div>
        </div>
        <div id="view-achievements" class="view">
            <div class="section-title">üèÜ ACHIEVEMENTS</div>
            <div class="achievements-grid" id="achievements-list"></div>
        </div>
        <div id="view-guilds" class="view">
            <div class="section-title">üõ°Ô∏è MY GUILD</div>
            <div id="my-guild-section">
                <div id="no-guild-state">
                    <div class="empty-state"><div class="empty-state-icon">üè∞</div>No guild yet<br><small>Create or join one!</small></div>
                    <input id="guild-name-input" placeholder="Guild name" maxlength="20">
                    <textarea id="guild-desc-input" placeholder="Description..." rows="3"></textarea>
                    <button class="btn" onclick="createGuild()">‚öîÔ∏è CREATE GUILD</button>
                </div>
                <div id="has-guild-state" style="display:none">
                    <div class="guild-header">
                        <div class="guild-name" id="guild-name-display">...</div>
                        <div class="guild-stats">
                            <div class="guild-stat"><div class="guild-stat-label">Total</div><div class="guild-stat-value" id="guild-total">0</div></div>
                            <div class="guild-stat"><div class="guild-stat-label">Level</div><div class="guild-stat-value" id="guild-level">1</div></div>
                            <div class="guild-stat"><div class="guild-stat-label">Members</div><div class="guild-stat-value" id="guild-members">0</div></div>
                        </div>
                    </div>
                    <button class="btn-decline" style="width:100%;margin-bottom:15px" onclick="leaveGuild()">Leave Guild</button>
                    <div class="members-list" id="members-list"></div>
                </div>
            </div>
            <div class="section-title mt-20">üìã ALL GUILDS</div>
            <div id="guilds-list"></div>
        </div>
        <div id="view-social" class="view">
            <div class="section-title">üë• FRIENDS</div>
            <div class="flex mb-20">
                <input id="friend-input" placeholder="Username" style="margin:0">
                <button class="btn small" onclick="sendFriendReq()">ADD</button>
            </div>
            <div id="friends-list"></div>
            <div class="section-title mt-20">üí¨ CHAT</div>
            <div id="chat-box"></div>
            <div class="flex">
                <input id="chat-input" placeholder="Message..." maxlength="200" style="margin:0" onkeypress="if(event.key==='Enter')sendMsg()">
                <button class="btn small" onclick="sendMsg()">‚û§</button>
            </div>
        </div>
        <div id="view-requests" class="view">
            <div class="section-title">üì¨ FRIEND REQUESTS</div>
            <div id="friend-requests"></div>
            <div class="section-title mt-20">üõ°Ô∏è GUILD INVITES</div>
            <div id="guild-invites"></div>
            <div class="section-title mt-20">‚öîÔ∏è JOIN REQUESTS</div>
            <div id="guild-join-requests"></div>
        </div>
    </main>
    <nav>
        <div class="nav-item active" onclick="switchView('clicker',this)"><span class="nav-icon">üç™</span><div>Click</div></div>
        <div class="nav-item" onclick="switchView('shop',this)"><span class="nav-icon">üõí</span><div>Shop</div></div>
        <div class="nav-item" onclick="switchView('achievements',this)"><span class="nav-icon">üèÜ</span><div>Achieve</div></div>
        <div class="nav-item" onclick="switchView('guilds',this)"><span class="nav-icon">üõ°Ô∏è</span><div>Guilds</div></div>
        <div class="nav-item" onclick="switchView('social',this)"><span class="nav-icon">üë•</span><div>Social</div></div>
        <div class="nav-item" onclick="switchView('requests',this)"><span class="nav-icon">üì¨</span><div>Requests</div><span class="notif-badge" id="notif-badge" style="display:none"></span></div>
    </nav>
    <script>
        const socket=io();let myData={pseudo:'',clicks:0,mult:1,auto:0,rank:{title:'Novice'},guild:null,prestige:0,daily_available:!1,gems:0},audioCtx=null;
        function createParticles(){const c=document.getElementById('particles');for(let i=0;i<50;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'%';p.style.animationDuration=Math.random()*10+5+'s';p.style.animationDelay=Math.random()*5+'s';c.appendChild(p)}}
        createParticles();
        function playSfx(f,d=.1){try{if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.setValueAtTime(f,audioCtx.currentTime);g.gain.setValueAtTime(.15,audioCtx.currentTime);g.gain.exponentialRampToValueAtTime(.01,audioCtx.currentTime+d);o.start();o.stop(audioCtx.currentTime+d)}catch(e){}}
        function toast(m,t='info'){const c=document.getElementById('toast-container'),to=document.createElement('div');to.className='toast '+t;to.innerHTML=(t==='achievement'?'üèÜ ':t==='success'?'‚úÖ ':t==='error'?'‚ùå ':'‚ÑπÔ∏è ')+m;c.appendChild(to);setTimeout(()=>to.remove(),3e3);playSfx(t==='error'?200:t==='success'?600:400,.1)}
        function auth(t){const u=document.getElementById('auth-user').value.trim(),p=document.getElementById('auth-pass').value;if(!u||!p)return toast('Fill all fields!','error');socket.emit('login_action',{pseudo:u,password:p,type:t})}
        socket.on('login_ok',d=>{document.getElementById('auth-overlay').style.display='none';myData=d;updateUI(d);toast('Welcome, '+d.pseudo+'! üéÆ','success');socket.emit('get_leaderboard');socket.emit('get_achievements');socket.emit('get_shop_items');socket.emit('get_social_data');if(d.guild)socket.emit('get_guild_data')});
        socket.on('error',m=>toast(m,'error'));
        socket.on('success',m=>toast(m,'success'));
        socket.on('notif',m=>toast(m,'info'));
        function updateUI(d){if(d.pseudo){myData.pseudo=d.pseudo;document.getElementById('my-pseudo').innerText=d.pseudo;document.getElementById('my-avatar').innerText=d.pseudo.charAt(0).toUpperCase()}if(d.clicks!==undefined){myData.clicks=d.clicks;document.getElementById('score-display').innerText=d.clicks.toLocaleString()}if(d.mult){myData.mult=d.mult;document.getElementById('mult-val').innerText=d.mult;document.getElementById('mult-cost').innerText=(d.mult*100).toLocaleString()}if(d.auto!==undefined){myData.auto=d.auto;document.getElementById('auto-val').innerText=d.auto;document.getElementById('auto-cost').innerText=((d.auto+1)*1000).toLocaleString()}if(d.rank){myData.rank=d.rank;document.getElementById('rank-badge').innerText=d.rank.title;document.getElementById('rank-badge').style.background=d.rank.color||'var(--primary)'}if(d.guild!==undefined){myData.guild=d.guild;document.getElementById('guild-badge').innerText=d.guild?`[${d.guild.toUpperCase()}]`:'[SOLO]';updateGuildUI()}if(d.prestige!==undefined){myData.prestige=d.prestige;document.getElementById('prestige-val').innerText=d.prestige;document.getElementById('prestige-btn').innerText=myData.clicks>=1e5?'‚ú® PRESTIGE NOW!':'‚ú® PRESTIGE (100K)'}if(d.daily_available!==undefined){myData.daily_available=d.daily_available;const btn=document.getElementById('daily-btn');btn.disabled=!d.daily_available;btn.innerText=d.daily_available?'üéÅ CLAIM':'üéÅ CLAIMED'}if(d.gems!==undefined)myData.gems=d.gems}
        function clickAction(){playSfx(440,.05);socket.emit('add_click')}
        socket.on('update_score',d=>updateUI(d));
        socket.on('update_full_state',d=>updateUI(d));
        function buyUpgrade(t){socket.emit('buy_upgrade',{type:t});playSfx(600,.1)}
        function prestige(){if(myData.clicks<1e5)return toast('Need 100,000 clicks!','error');if(confirm('Reset everything for prestige?'))socket.emit('prestige')}
        socket.on('prestige_complete',d=>{toast(`Prestige level ${d.new_level}! +${d.points_gained} points! üåü`,'success');updateUI({clicks:0,mult:1,auto:0,prestige:d.new_level})});
        socket.on('leaderboard_update',d=>{const medals=['gold','silver','bronze'];document.getElementById('lb-content').innerHTML=d.players.map((p,i)=>{const r=p.rank||i+1,m=medals[r-1]||'',self=p.pseudo===myData.pseudo;return`<div class="lb-item${self?' me':''}"><div class="flex"><div class="lb-rank ${m}">${r}</div><div class="lb-player"><div class="lb-name">${p.pseudo}</div><div class="lb-guild">${p.guild_name||'No guild'}</div></div></div><div class="lb-score">${(p.clicks||0).toLocaleString()}</div></div>`}).join('')||'<div class="empty-state">No players</div>'});
        function updateGuildUI(){const h=myData.guild!==null;document.getElementById('no-guild-state').style.display=h?'none':'block';document.getElementById('has-guild-state').style.display=h?'block':'none'}
        function createGuild(){const n=document.getElementById('guild-name-input').value.trim(),d=document.getElementById('guild-desc-input').value.trim();if(!n)return toast('Enter guild name!','error');socket.emit('create_guild',{name:n,description:d})}
        function leaveGuild(){if(confirm('Really leave?'))socket.emit('leave_guild')}
        function joinGuild(n){socket.emit('join_guild_request',{name:n})}
        socket.on('guild_data',d=>{document.getElementById('guild-name-display').innerText=d.name;document.getElementById('guild-total').innerText=(d.total_clicks||0).toLocaleString();document.getElementById('guild-level').innerText=d.level||1;document.getElementById('guild-members').innerText=d.member_count||0;document.getElementById('members-list').innerHTML=(d.members||[]).map(m=>`<div class="member-card"><div><b>${m.pseudo}</b><br><small>${(m.clicks||0).toLocaleString()} clicks</small></div></div>`).join('')});
        socket.on('guild_list',d=>{document.getElementById('guilds-list').innerHTML=(d.guilds||[]).map(g=>`<div class="member-card"><div><b style="color:var(--accent)">${g.name}</b><br><small>${g.member_count||0} members ‚Ä¢ ${(g.total_clicks||0).toLocaleString()} clicks</small></div><button class="btn-accept" onclick="joinGuild('${g.name}')">Join</button></div>`).join('')});
        function sendFriendReq(){const t=document.getElementById('friend-input').value.trim();if(!t)return toast('Enter username!','error');socket.emit('send_friend_request',{target:t});document.getElementById('friend-input').value=''}
        function removeFriend(p){if(confirm(`Remove ${p}?`))socket.emit('remove_friend',{target:p})}
        function respondFriend(t,a){socket.emit('respond_friend_request',{target:t,action:a})}
        function respondGuildInvite(g,a){socket.emit('respond_guild_invite',{guild_name:g,action:a})}
        function respondGuildJoin(r,g,a){socket.emit('respond_guild_join_request',{requester:r,guild_name:g,action:a})}
        socket.on('social_update',d=>{document.getElementById('friends-list').innerHTML=(d.friends||[]).map(f=>`<div class="friend-card"><span><b>${f}</b></span><button class="btn-decline small" onclick="removeFriend('${f}')">Remove</button></div>`).join('')||'<div class="empty-state">No friends</div>';document.getElementById('friend-requests').innerHTML=(d.friend_requests||[]).map(r=>`<div class="request-card"><b>${r}</b> wants to be friends<div class="request-actions"><button class="btn-accept" onclick="respondFriend('${r}','accept')">‚úì</button><button class="btn-decline" onclick="respondFriend('${r}','decline')">‚úó</button></div></div>`).join('')||'<div class="empty-state">No requests</div>';document.getElementById('guild-invites').innerHTML=(d.guild_invites||[]).map(i=>`<div class="request-card"><b style="color:var(--accent)">${i.guild||i}</b> invited you<div class="request-actions"><button class="btn-accept" onclick="respondGuildInvite('${i.guild||i}','accept')">‚úì</button><button class="btn-decline" onclick="respondGuildInvite('${i.guild||i}','decline')">‚úó</button></div></div>`).join('')||'<div class="empty-state">No invites</div>';document.getElementById('guild-join-requests').innerHTML=(d.guild_join_requests||[]).map(r=>`<div class="request-card"><b>${r.requester}</b> wants to join ${r.guild_name}<div class="request-actions"><button class="btn-accept" onclick="respondGuildJoin('${r.requester}','${r.guild_name}','accept')">‚úì</button><button class="btn-decline" onclick="respondGuildJoin('${r.requester}','${r.guild_name}','decline')">‚úó</button></div></div>`).join('')||'<div class="empty-state">No requests</div>';const n=(d.friend_requests||[]).length+(d.guild_invites||[]).length+(d.guild_join_requests||[]).length;const b=document.getElementById('notif-badge');if(n>0){b.style.display='flex';b.innerText=n}else b.style.display='none'});
        function sendMsg(){const i=document.getElementById('chat-input'),m=i.value.trim();if(!m)return;socket.emit('send_message',{message:m});i.value=''}
        socket.on('new_message',d=>{const b=document.getElementById('chat-box'),msg=document.createElement('div');msg.className='chat-message';msg.innerHTML=`<span class="chat-author">${d.user}:</span><span class="chat-text">${d.message}</span>`;b.appendChild(msg);b.scrollTop=b.scrollHeight;if(d.user!==myData.pseudo)playSfx(500,.05)});
        socket.on('chat_history',d=>{const b=document.getElementById('chat-box');b.innerHTML=(d.messages||[]).map(m=>`<div class="chat-message"><span class="chat-author">${m.user}:</span><span class="chat-text">${m.message}</span></div>`).join('')});
        socket.on('achievements_data',d=>{document.getElementById('achievements-list').innerHTML=(d.achievements||[]).map(a=>`<div class="achievement-card ${a.unlocked?'unlocked':'locked'}"><div class="achievement-icon">${a.icon}</div><div class="achievement-info"><div class="achievement-name">${a.name}</div><div class="achievement-desc">${a.desc}</div><div class="achievement-reward">+${a.reward} clicks</div></div></div>`).join('')});
        socket.on('achievement_unlocked',d=>{(d.achievements||[]).forEach(a=>toast(`${a.name} unlocked! +${a.reward}! ${a.icon}`,'achievement'));socket.emit('get_achievements')});
        socket.on('shop_items',d=>{document.getElementById('shop-items').innerHTML=(d.items||[]).map(i=>`<div class="powerup-card" onclick="buyItem(${i.id})"><div class="powerup-icon">${i.icon}</div><div class="powerup-name">${i.name}</div><div class="powerup-desc">${i.description}</div><div class="powerup-cost">${i.price_clicks?i.price_clicks.toLocaleString()+' clicks':i.price_gems+' gems'}</div><button class="btn small">BUY</button></div>`).join('')});
        function buyItem(id){socket.emit('buy_shop_item',{item_id:id})}
        socket.on('powerup_activated',d=>{const div=document.createElement('div');div.className='powerup-active';div.innerHTML=`${d.name}: ${d.multiplier}x for ${d.duration}s`;document.body.appendChild(div);setTimeout(()=>div.remove(),d.duration*1e3)});
        socket.on('powerup_ended',()=>toast('Power-up ended!','info'));
        function claimDaily(){socket.emit('claim_daily_reward')}
        socket.on('daily_claimed',d=>{updateUI({daily_available:!1});toast(`Streak: ${d.streak} days! üî•`,'success')});
        function switchView(v,el){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById('view-'+v).classList.add('active');el.classList.add('active');playSfx(350,.05);if(v==='clicker')socket.emit('get_leaderboard');else if(v==='shop')socket.emit('get_shop_items');else if(v==='achievements')socket.emit('get_achievements');else if(v==='guilds'){socket.emit('get_guilds');if(myData.guild)socket.emit('get_guild_data')}else if(v==='social'||v==='requests'){socket.emit('get_social_data');if(v==='social')socket.emit('get_chat_history')}}
        function getGameConfig(){socket.emit('get_achievements');socket.emit('get_shop_items')}
        setTimeout(getGameConfig,1e3);
    </script>
</body>
</html>
{% endraw %}
